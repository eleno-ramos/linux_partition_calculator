services:
  - type: web
    name: linux-partition-calculator
    runtime: node
    plan: starter
    buildCommand: pnpm install && pnpm build
    startCommand: node dist/index.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: DATABASE_URL
        fromDatabase:
          name: linux-partition-db
          property: connectionString
      - key: JWT_SECRET
        generateValue: true
      - key: VITE_APP_ID
        sync: false
      - key: OAUTH_SERVER_URL
        sync: false
      - key: VITE_OAUTH_PORTAL_URL
        sync: false
      - key: OWNER_OPEN_ID
        sync: false
      - key: OWNER_NAME
        sync: false
      - key: BUILT_IN_FORGE_API_URL
        sync: false
      - key: BUILT_IN_FORGE_API_KEY
        sync: false
      - key: VITE_FRONTEND_FORGE_API_KEY
        sync: false
      - key: VITE_FRONTEND_FORGE_API_URL
        sync: false
      - key: VITE_ANALYTICS_ENDPOINT
        sync: false
      - key: VITE_ANALYTICS_WEBSITE_ID
        sync: false
    routes:
      - path: /
        destination: /
      - path: /api/*
        destination: /api/*
    healthCheckPath: /
    preDeployCommand: pnpm db:push

databases:
  - name: linux-partition-db
    databaseName: linux_partition_calculator
    user: postgres
    plan: starter

envVarGroups:
  - name: Production OAuth
    envVars:
      - key: VITE_APP_ID
        value: # Set your Manus OAuth App ID
      - key: OAUTH_SERVER_URL
        value: https://api.manus.im
      - key: VITE_OAUTH_PORTAL_URL
        value: https://auth.manus.im
      - key: OWNER_OPEN_ID
        value: # Set owner's OpenID
      - key: OWNER_NAME
        value: # Set owner's name
      - key: BUILT_IN_FORGE_API_URL
        value: https://api.manus.im
      - key: BUILT_IN_FORGE_API_KEY
        value: # Set Forge API key
      - key: VITE_FRONTEND_FORGE_API_KEY
        value: # Set Frontend Forge API key
      - key: VITE_FRONTEND_FORGE_API_URL
        value: https://api.manus.im
      - key: VITE_ANALYTICS_ENDPOINT
        value: # Set analytics endpoint
      - key: VITE_ANALYTICS_WEBSITE_ID
        value: # Set analytics website ID

# Deploy Configuration
deploy:
  # Render will automatically deploy on git push to main
  branch: main
  autoDeployOnPush: true
  
  # Pre-deployment checks
  preDeployScript: |
    echo "Running database migrations..."
    pnpm db:push
    echo "Database migrations completed"

# Monitoring and Logging
monitoring:
  healthCheckInterval: 300
  healthCheckTimeout: 30
  
# Scaling
scaling:
  minInstances: 1
  maxInstances: 3
  cpuThreshold: 70
  memoryThreshold: 80

# Backup Configuration
backups:
  enabled: true
  frequency: daily
  retention: 30 # days
